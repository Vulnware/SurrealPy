<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>surrealpy.handler API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>surrealpy.handler</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import os
import threading
import subprocess as sp
import psutil
import shlex
import logging
import socket

# create logger object
logger = logging.getLogger(&#34;surrealpy.sync.client&#34;)

# if operation system is windows set process name to surreal.exe
if os.name == &#34;nt&#34;:
    processName = &#34;surreal.exe&#34;
elif os.name == &#34;posix&#34;:
    processName = &#34;surreal&#34;
else:
    print(&#34;Unknown OS&#34;)
    exit(1)


def checkIfProcessRunning(processName):
    &#34;&#34;&#34;
    Check if there is any running process that contains the given name processName.
    &#34;&#34;&#34;
    # Iterate over the all the running process
    for proc in psutil.process_iter():
        try:
            # Check if process name contains the given name string.
            if processName.lower() in proc.name().lower():
                return True
        except (psutil.NoSuchProcess, psutil.AccessDenied, psutil.ZombieProcess):
            pass
    return False


# this is a thread safe singleton class
# with this class we can start a thread to handle the database process
def getAvaiblePort():
    sock = socket.socket()
    sock.bind((&#34;&#34;, 0))

    return sock.getsockname()[1]


class SurrealDBHandler(threading.Thread):
    def __init__(
        self,
        uri: str,
        username: str,
        password: str,
        *,
        host: str = &#34;0.0.0.0&#34;,
        port: int = None,
        scheme: str = &#34;http&#34;,
    ) -&gt; None:
        # check if surreal is already running
        threading.Thread.__init__(self, daemon=True)
        if checkIfProcessRunning(processName):
            print(&#34;Surreal is already running&#34;)
            exit(1)

        # check if uri is filepath
        self.__uri = uri
        self.__username = username
        self.__password = password
        self.__host = host
        self.__port = port or getAvaiblePort()
        self.__canrun = True
        self.__scheme = scheme
        if uri == &#34;memory&#34;:
            self.__uri = &#34;memory&#34;
        else:
            self.__uri = &#34;file://&#34; + uri

        # start the database process
        self.__commandTemplate = &#34;surreal start --log debug  --user {username} --pass {password} --bind {host}:{port} {uri}&#34;
        self.__command = self.__commandTemplate.format(
            username=self.username,
            password=self.password,
            uri=self.__uri,
            host=host,
            port=port,
        )
        self.__parsedCommand = shlex.split(self.__command)
        # call the super class constructor

    def run(self):
        # start the database process
        self.__process = sp.Popen(self.__parsedCommand)
        # read the output of the process and log it
        while self.__canrun:
            output = self.__process.stdout.readline()
            if output == &#34;&#34; and self.__process.poll() is not None:
                break
            if output:
                logger.debug(output.strip())

    @property
    def uri(self):
        return self.__uri

    @property
    def command(self):
        return self.__command

    @property
    def username(self):
        return self.__username

    @property
    def password(self):
        return self.__password

    @property
    def host(self):
        return self.__host

    @property
    def port(self):
        return self.__port

    @property
    def bind(self):
        return self.__host + &#34;:&#34; + str(self.__port)

    @property
    def scheme(self):
        return self.__scheme

    def stop(self):
        self.__process.terminate()
        self.__process.wait()
        self.__canrun = False
        logger.debug(&#34;Surreal process terminated&#34;)

    @property
    def sql(self):
        return &#34;{scheme}://{host}:{port}/sql&#34;.format(
            scheme=self.scheme,
            host=self.host,
            port=self.port,
        )</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="surrealpy.handler.checkIfProcessRunning"><code class="name flex">
<span>def <span class="ident">checkIfProcessRunning</span></span>(<span>processName)</span>
</code></dt>
<dd>
<div class="desc"><p>Check if there is any running process that contains the given name processName.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def checkIfProcessRunning(processName):
    &#34;&#34;&#34;
    Check if there is any running process that contains the given name processName.
    &#34;&#34;&#34;
    # Iterate over the all the running process
    for proc in psutil.process_iter():
        try:
            # Check if process name contains the given name string.
            if processName.lower() in proc.name().lower():
                return True
        except (psutil.NoSuchProcess, psutil.AccessDenied, psutil.ZombieProcess):
            pass
    return False</code></pre>
</details>
</dd>
<dt id="surrealpy.handler.getAvaiblePort"><code class="name flex">
<span>def <span class="ident">getAvaiblePort</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def getAvaiblePort():
    sock = socket.socket()
    sock.bind((&#34;&#34;, 0))

    return sock.getsockname()[1]</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="surrealpy.handler.SurrealDBHandler"><code class="flex name class">
<span>class <span class="ident">SurrealDBHandler</span></span>
<span>(</span><span>uri: str, username: str, password: str, *, host: str = '0.0.0.0', port: int = None, scheme: str = 'http')</span>
</code></dt>
<dd>
<div class="desc"><p>A class that represents a thread of control.</p>
<p>This class can be safely subclassed in a limited fashion. There are two ways
to specify the activity: by passing a callable object to the constructor, or
by overriding the run() method in a subclass.</p>
<p>This constructor should always be called with keyword arguments. Arguments are:</p>
<p><em>group</em> should be None; reserved for future extension when a ThreadGroup
class is implemented.</p>
<p><em>target</em> is the callable object to be invoked by the run()
method. Defaults to None, meaning nothing is called.</p>
<p><em>name</em> is the thread name. By default, a unique name is constructed of
the form "Thread-N" where N is a small decimal number.</p>
<p><em>args</em> is the argument tuple for the target invocation. Defaults to ().</p>
<p><em>kwargs</em> is a dictionary of keyword arguments for the target
invocation. Defaults to {}.</p>
<p>If a subclass overrides the constructor, it must make sure to invoke
the base class constructor (Thread.<strong>init</strong>()) before doing anything
else to the thread.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class SurrealDBHandler(threading.Thread):
    def __init__(
        self,
        uri: str,
        username: str,
        password: str,
        *,
        host: str = &#34;0.0.0.0&#34;,
        port: int = None,
        scheme: str = &#34;http&#34;,
    ) -&gt; None:
        # check if surreal is already running
        threading.Thread.__init__(self, daemon=True)
        if checkIfProcessRunning(processName):
            print(&#34;Surreal is already running&#34;)
            exit(1)

        # check if uri is filepath
        self.__uri = uri
        self.__username = username
        self.__password = password
        self.__host = host
        self.__port = port or getAvaiblePort()
        self.__canrun = True
        self.__scheme = scheme
        if uri == &#34;memory&#34;:
            self.__uri = &#34;memory&#34;
        else:
            self.__uri = &#34;file://&#34; + uri

        # start the database process
        self.__commandTemplate = &#34;surreal start --log debug  --user {username} --pass {password} --bind {host}:{port} {uri}&#34;
        self.__command = self.__commandTemplate.format(
            username=self.username,
            password=self.password,
            uri=self.__uri,
            host=host,
            port=port,
        )
        self.__parsedCommand = shlex.split(self.__command)
        # call the super class constructor

    def run(self):
        # start the database process
        self.__process = sp.Popen(self.__parsedCommand)
        # read the output of the process and log it
        while self.__canrun:
            output = self.__process.stdout.readline()
            if output == &#34;&#34; and self.__process.poll() is not None:
                break
            if output:
                logger.debug(output.strip())

    @property
    def uri(self):
        return self.__uri

    @property
    def command(self):
        return self.__command

    @property
    def username(self):
        return self.__username

    @property
    def password(self):
        return self.__password

    @property
    def host(self):
        return self.__host

    @property
    def port(self):
        return self.__port

    @property
    def bind(self):
        return self.__host + &#34;:&#34; + str(self.__port)

    @property
    def scheme(self):
        return self.__scheme

    def stop(self):
        self.__process.terminate()
        self.__process.wait()
        self.__canrun = False
        logger.debug(&#34;Surreal process terminated&#34;)

    @property
    def sql(self):
        return &#34;{scheme}://{host}:{port}/sql&#34;.format(
            scheme=self.scheme,
            host=self.host,
            port=self.port,
        )</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>threading.Thread</li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="surrealpy.handler.SurrealDBHandler.bind"><code class="name">var <span class="ident">bind</span></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def bind(self):
    return self.__host + &#34;:&#34; + str(self.__port)</code></pre>
</details>
</dd>
<dt id="surrealpy.handler.SurrealDBHandler.command"><code class="name">var <span class="ident">command</span></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def command(self):
    return self.__command</code></pre>
</details>
</dd>
<dt id="surrealpy.handler.SurrealDBHandler.host"><code class="name">var <span class="ident">host</span></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def host(self):
    return self.__host</code></pre>
</details>
</dd>
<dt id="surrealpy.handler.SurrealDBHandler.password"><code class="name">var <span class="ident">password</span></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def password(self):
    return self.__password</code></pre>
</details>
</dd>
<dt id="surrealpy.handler.SurrealDBHandler.port"><code class="name">var <span class="ident">port</span></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def port(self):
    return self.__port</code></pre>
</details>
</dd>
<dt id="surrealpy.handler.SurrealDBHandler.scheme"><code class="name">var <span class="ident">scheme</span></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def scheme(self):
    return self.__scheme</code></pre>
</details>
</dd>
<dt id="surrealpy.handler.SurrealDBHandler.sql"><code class="name">var <span class="ident">sql</span></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def sql(self):
    return &#34;{scheme}://{host}:{port}/sql&#34;.format(
        scheme=self.scheme,
        host=self.host,
        port=self.port,
    )</code></pre>
</details>
</dd>
<dt id="surrealpy.handler.SurrealDBHandler.uri"><code class="name">var <span class="ident">uri</span></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def uri(self):
    return self.__uri</code></pre>
</details>
</dd>
<dt id="surrealpy.handler.SurrealDBHandler.username"><code class="name">var <span class="ident">username</span></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def username(self):
    return self.__username</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="surrealpy.handler.SurrealDBHandler.run"><code class="name flex">
<span>def <span class="ident">run</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Method representing the thread's activity.</p>
<p>You may override this method in a subclass. The standard run() method
invokes the callable object passed to the object's constructor as the
target argument, if any, with sequential and keyword arguments taken
from the args and kwargs arguments, respectively.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def run(self):
    # start the database process
    self.__process = sp.Popen(self.__parsedCommand)
    # read the output of the process and log it
    while self.__canrun:
        output = self.__process.stdout.readline()
        if output == &#34;&#34; and self.__process.poll() is not None:
            break
        if output:
            logger.debug(output.strip())</code></pre>
</details>
</dd>
<dt id="surrealpy.handler.SurrealDBHandler.stop"><code class="name flex">
<span>def <span class="ident">stop</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def stop(self):
    self.__process.terminate()
    self.__process.wait()
    self.__canrun = False
    logger.debug(&#34;Surreal process terminated&#34;)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="surrealpy" href="../index.html">surrealpy</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="surrealpy.handler.checkIfProcessRunning" href="#surrealpy.handler.checkIfProcessRunning">checkIfProcessRunning</a></code></li>
<li><code><a title="surrealpy.handler.getAvaiblePort" href="#surrealpy.handler.getAvaiblePort">getAvaiblePort</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="surrealpy.handler.SurrealDBHandler" href="#surrealpy.handler.SurrealDBHandler">SurrealDBHandler</a></code></h4>
<ul class="two-column">
<li><code><a title="surrealpy.handler.SurrealDBHandler.bind" href="#surrealpy.handler.SurrealDBHandler.bind">bind</a></code></li>
<li><code><a title="surrealpy.handler.SurrealDBHandler.command" href="#surrealpy.handler.SurrealDBHandler.command">command</a></code></li>
<li><code><a title="surrealpy.handler.SurrealDBHandler.host" href="#surrealpy.handler.SurrealDBHandler.host">host</a></code></li>
<li><code><a title="surrealpy.handler.SurrealDBHandler.password" href="#surrealpy.handler.SurrealDBHandler.password">password</a></code></li>
<li><code><a title="surrealpy.handler.SurrealDBHandler.port" href="#surrealpy.handler.SurrealDBHandler.port">port</a></code></li>
<li><code><a title="surrealpy.handler.SurrealDBHandler.run" href="#surrealpy.handler.SurrealDBHandler.run">run</a></code></li>
<li><code><a title="surrealpy.handler.SurrealDBHandler.scheme" href="#surrealpy.handler.SurrealDBHandler.scheme">scheme</a></code></li>
<li><code><a title="surrealpy.handler.SurrealDBHandler.sql" href="#surrealpy.handler.SurrealDBHandler.sql">sql</a></code></li>
<li><code><a title="surrealpy.handler.SurrealDBHandler.stop" href="#surrealpy.handler.SurrealDBHandler.stop">stop</a></code></li>
<li><code><a title="surrealpy.handler.SurrealDBHandler.uri" href="#surrealpy.handler.SurrealDBHandler.uri">uri</a></code></li>
<li><code><a title="surrealpy.handler.SurrealDBHandler.username" href="#surrealpy.handler.SurrealDBHandler.username">username</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>